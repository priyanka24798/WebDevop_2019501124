<!DOCTYPE html>
<html>
    <head>
        <title>HomePage</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
        <!-- <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">         -->
        <script>
        var global_isbn;
        document.addEventListener('DOMContentLoaded', ()=> {
            document.querySelector("#search-button").onclick = () => {
                const request = new XMLHttpRequest()
                const type = document.querySelector(".form-type").value
                const BookDetails = document.querySelector(".Bar").value
                request.open('POST','/api/search')

                const data = new FormData()
                data.append('type',type)
                data.append('query',BookDetails)
                request.send(data)

                request.onload = () => {
                    const data = JSON.parse(request.responseText)
                    console.log(data)
                    
                    if (data.allBooks.length === 0) {
                        document.querySelector("#no-results").innerHTML = "No results"
                        document.querySelector("#zoom-title").innerHTML = ""
                        document.querySelector("#book").innerHTML = ""
                        x.style.display = "none"
                        
                        return false
                    } else {
                        document.querySelector("#no-results").innerHTML = data.allBooks.length + ' books found'
                        document.querySelector("#zoom-title").innerHTML = ""
                        document.querySelector("#book").innerHTML = ""
                        x.style.display = "none"
                        for (key in data.allBooks) {
                        const book = document.createElement("a");
                        book.innerText = data.allBooks[key]["title"]
                        book.setAttribute("href","#");
                        
                        let isbn_book = data.allBooks[key]["isbn"]
                        //global_isbn = isbn_book
                        book.onclick = () => {bookpage(isbn_book)};

                        document.querySelector("#zoom-title").append(book)
                        document.querySelector("#zoom-title").append(document.createElement('br'))
                        }
                    }
                }
                return false
            }
        });
        </script>
    </head>
    <body class = "body_result">
        <div id = "topBar" style="padding-bottom: 70px;">
            <div id = "display_username"  style="float: left;padding-left: 15px;">welcome <span id = "userName">{{ name }}</span></div>
            <div id = "logout" style="float: right;"><a href="{{ url_for('logout') }}">Logout</a></div>
        </div>
        <div class="container" >
            <div class = "searchBar_result">
                <form>
                    <select class="form-type" name="type">
                        <option value="isbn">Isbn</option>
                        <option value="title">title</option>
                        <option value="author">author</option>
                    </select>
                    <input type="search" class = "Bar" name="BookDetails" placeholder="BookDetails" value="{{ query }}" required>
                    <button id = "search-button">search</button>
                </form>
                <p id="no-results"></p>
                <div id="zoom-title">

                </div>
                
            </div>
            <div class="actual">
                <div class= "BookPage" >
                    <div id = "book" style="color:red;">
                        
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>